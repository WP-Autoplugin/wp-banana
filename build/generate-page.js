(()=>{"use strict";var e={n:a=>{var n=a&&a.__esModule?()=>a.default:()=>a;return e.d(n,{a:n}),n},d:(a,n)=>{for(var t in n)e.o(n,t)&&!e.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:n[t]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.element,n=window.wp.i18n,t=window.React,r=window.wp.apiFetch;var s=e.n(r);const i=window.wp.components,l=window.ReactJSXRuntime,o={gemini:["gemini-2.5-flash-image-preview","gemini-2.5-flash-image"],openai:["gpt-image-1","gpt-image-1-mini"],replicate:["google/nano-banana","bytedance/seedream-4","reve/remix"]},d={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp"},c=[1,2,3,4],p=(e,a,n)=>{var t;const r=`reference-${a}`,s=e&&e.trim().length>0?e.trim():r,i=null!==(t=d[n.toLowerCase()])&&void 0!==t?t:"";if(""===i)return s;if(s.toLowerCase().endsWith(`.${i}`))return s;const l=s.lastIndexOf(".");return l>0?`${s.slice(0,l)}.${i}`:`${s}.${i}`},u=e=>{if(!e)return"png";const a=d[e.toLowerCase()];return null!=a?a:"png"},m=e=>{switch(e){case"queued":case"loading":return(0,n.__)("Generating…","wp-banana");case"complete":return(0,n.__)("Ready","wp-banana");case"saving":return(0,n.__)("Saving…","wp-banana");case"saved":return(0,n.__)("Saved","wp-banana");case"error":return(0,n.__)("Failed","wp-banana");default:return""}},f=({providers:e,restNamespace:r,onComplete:d,defaultGeneratorModel:f,defaultGeneratorProvider:g,aspectRatioOptions:b,defaultAspectRatio:h,enableReferenceDragDrop:w=!1})=>{var v;const x=(0,a.useMemo)(()=>e.filter(e=>!1!==e.connected),[e]),_=(0,a.useMemo)(()=>Array.isArray(b)?b.map(e=>"string"==typeof e?e.trim().toUpperCase():"").filter(e=>e.length>0):[],[b]),y=(0,a.useMemo)(()=>{var e;if("string"==typeof h){const e=h.trim().toUpperCase();if(e&&_.includes(e))return e}return null!==(e=_[0])&&void 0!==e?e:""},[_,h]),j=(0,a.useMemo)(()=>{var a;if(g){const e=x.find(e=>e.slug===g);if(e)return e.slug}if(f){const a=x.find(e=>e.default_model===f);if(a)return a.slug;const n=e.find(e=>e.default_model===f);if(n){const e=x.find(e=>e.slug===n.slug);if(e)return e.slug}}return x.length>0?x[0].slug:null!==(a=e[0]?.slug)&&void 0!==a?a:""},[x,e,g,f]),[C,k]=(0,a.useState)(j),[R,S]=(0,a.useState)(""),[N,E]=(0,a.useState)([]),[A,D]=(0,a.useState)(""),[L,M]=(0,a.useState)(!1),[P,U]=(0,a.useState)(null),[O,$]=(0,a.useState)(null),[G,I]=(0,a.useState)(!1),[T,F]=(0,a.useState)(y),[B,W]=(0,a.useState)(!1),[H,z]=(0,a.useState)([]),[q,Q]=(0,a.useState)(null),[K,Y]=(0,a.useState)(!1),V=(0,t.useRef)(null),J=(0,t.useRef)(H),X=(0,t.useRef)(0),[Z,ee]=(0,a.useState)(!1),[ae,ne]=(0,a.useState)(!1),[te,re]=(0,a.useState)([]),[se,ie]=(0,a.useState)(null),[le,oe]=(0,a.useState)(null),de=(0,t.useRef)(null),ce=(0,t.useRef)([]),pe=(0,t.useRef)([]),ue=(0,t.useRef)(!1),me=(0,t.useRef)({successes:0,errors:[]}),fe=(0,t.useCallback)(()=>{0!==pe.current.length&&(pe.current.forEach(e=>window.clearTimeout(e)),pe.current=[])},[]),ge=H.length,be=ge>1,he=(0,a.useMemo)(()=>{var e;if(!be)return N;const a=null!==(e=o[C])&&void 0!==e?e:[];if(0===a.length)return[];const n=new Set(a);return N.filter(e=>n.has(e))},[N,be,C]),we=0===ge&&_.length>0,ve=(0,a.useMemo)(()=>{if(0===te.length)return null;const e=te.find(e=>e.id===se);return null!=e?e:te[0]},[te,se]),xe=ve&&ve.data&&ve.mime?`data:${ve.mime};base64,${ve.data}`:"",_e=!!ve&&("complete"===ve.status||"error"===ve.status),ye=!!ve&&"saving"!==ve.status&&"saved"!==ve.status;(0,a.useEffect)(()=>{J.current=H},[H]),(0,a.useEffect)(()=>{ce.current=te},[te]),(0,a.useEffect)(()=>{0!==te.length?te.some(e=>e.id===se)||ie(te[0].id):null!==se&&ie(null)},[te,se]),(0,a.useEffect)(()=>{if(!Z)return;const e=e=>{de.current&&e.target instanceof Node&&!de.current.contains(e.target)&&ee(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[Z]),(0,a.useEffect)(()=>()=>{J.current.forEach(e=>{e.revokeOnCleanup&&e.url&&window.URL.revokeObjectURL(e.url)})},[]);const je=(0,t.useCallback)(()=>{J.current.forEach(e=>{e.revokeOnCleanup&&e.url&&window.URL.revokeObjectURL(e.url)}),z([]),Q(null)},[]),Ce=(0,t.useCallback)(e=>{if(S(""),$(null),je(),!Array.isArray(e)||0===e.length)return;const a=[];e.slice(0,4).forEach(e=>{if(!e.sourceUrl||0===e.sourceUrl.length)return;const n=`${Date.now()}-${Math.random().toString(36).slice(2)}`,t=e.sourceUrl,r=e.previewUrl&&e.previewUrl.length>0?e.previewUrl:t;a.push({id:n,url:r,sourceUrl:t,filename:e.filename,mimeType:e.mime})}),z(a),J.current=a,e.length>4&&Q((0,n.__)("Only the first 4 selected images were attached as references.","wp-banana"))},[je]);(0,a.useEffect)(()=>{const e=e=>{if(!e)return;const a=window,n=a.wpBananaReferenceQueue;if(!Array.isArray(n)||0===n.length)return;const t=n.indexOf(e);t>=0&&n.splice(t,1),0===n.length&&delete a.wpBananaReferenceQueue},a=a=>{const n=a,t=n.detail?.references;Array.isArray(t)&&0!==t.length?(e(t),Ce(t)):e(t)};return(()=>{const e=window,a=e.wpBananaReferenceQueue;if(Array.isArray(a)&&0!==a.length){for(;a.length>0;){const e=a.shift();Array.isArray(e)&&e.length>0&&Ce(e)}delete e.wpBananaReferenceQueue}})(),window.addEventListener("wp-banana:set-reference-images",a),()=>{window.removeEventListener("wp-banana:set-reference-images",a)}},[Ce]),(0,a.useEffect)(()=>{ge>0?""!==T&&F(""):0!==_.length?_.includes(T)||y!==T&&F(y):""!==T&&F("")},[_,T,y,ge]);const ke=(0,a.useMemo)(()=>e.find(e=>e.slug===C),[C,e]),Re=(0,a.useMemo)(()=>{var a;if(ke?.label)return ke.label;const n=e.find(e=>e.slug===C);return null!==(a=n?.label)&&void 0!==a?a:C?C.toUpperCase():""},[C,e,ke]),Se=(0,a.useMemo)(()=>{const e=we?T||(0,n.__)("Default aspect ratio","wp-banana"):"",a=ke?.default_model?String(ke.default_model):"";let t=A||(L?(0,n.__)("Loading model…","wp-banana"):""!==a?a:(0,n.__)("Provider default model","wp-banana"));be&&0===he.length&&(t=(0,n.__)("No compatible model","wp-banana"));const r=Re,s=ge>0?(0,n.sprintf)((0,n._n)("%d reference","%d references",ge,"wp-banana"),ge):"";return{aspect:e,model:t,provider:r,references:s,fallback:e||t||r||s?"":(0,n.__)("Using provider defaults","wp-banana")}},[we,T,A,L,Re,ke,be,he,ge]);(0,a.useEffect)(()=>{C&&x.some(e=>e.slug===C)||j&&k(j)},[j,C,x]),(0,a.useEffect)(()=>{if(!C)return;const e=ge>0?"edit":"generate";let a=!0;return M(!0),U(null),s()({path:`${r}/models?provider=${C}&purpose=${e}`}).then(e=>{if(!a)return;const n=e,t=Array.isArray(n.models)?n.models:[];if(E(t),0===t.length)return void D("");const r=(ge>0?[ke?.default_model]:[f,ke?.default_model]).find(e=>!!e&&t.includes(e));D(r||t[0])}).catch(e=>{var t;a&&(E([]),D(""),U(null!==(t=e?.message)&&void 0!==t?t:(0,n.__)("Failed to load models.","wp-banana")))}).finally(()=>{a&&M(!1)}),()=>{a=!1}},[C,r,ke,f,ge]),(0,a.useEffect)(()=>{L||(0!==he.length?he.includes(A)||D(he[0]):be&&""!==A&&D(""))},[he,A,L,be]);const Ne=(0,a.useMemo)(()=>he.length>0?""!==A&&he.includes(A):!be&&(""!==A||0===N.length),[he,A,be,N]),Ee=(0,a.useMemo)(()=>!(G||L||R.trim().length<3||""===C||!Ne||we&&""===T),[G,L,R,C,Ne,we,T]),Ae=(0,t.useCallback)(()=>{V.current&&V.current.click()},[]),De=(0,t.useCallback)(e=>{if(!Array.isArray(e)||0===e.length)return;const a=Array.isArray(J.current)?J.current:[];let t=Math.max(0,4-a.length),r=0,s=0;const i=[];if(e.forEach(e=>{if(!e?.type||!e.type.startsWith("image/"))return;if(s+=1,t<=0)return;const a=`${Date.now()}-${Math.random().toString(36).slice(2)}`,n=window.URL.createObjectURL(e);i.push({id:a,file:e,url:n,revokeOnCleanup:!0,filename:e.name,mimeType:e.type}),t-=1,r+=1}),r>0){const e=[...a,...i];J.current=e,z(e),$(null),Q(s>r?(0,n.__)("You can upload up to 4 reference images.","wp-banana"):null)}else s>0&&Q((0,n.__)("You can upload up to 4 reference images.","wp-banana"))},[z,$,Q]),Le=(0,t.useCallback)(e=>{const a=e.target.files;a&&a.length>0&&De(Array.from(a)),e.target.value=""},[De]),Me=(0,t.useCallback)(e=>{const a=H.filter(a=>a.id!==e||(a.revokeOnCleanup&&a.url&&window.URL.revokeObjectURL(a.url),!1));z(a),Q(null)},[H]),Pe=(0,t.useCallback)(async()=>{const e=Array.isArray(J.current)?[...J.current]:[],a=[];let t=!1;for(let r=0;r<e.length;r+=1){const s=e[r];if(s.file instanceof File){a.push(s.file);continue}if(!s.sourceUrl)throw new Error((0,n.__)("Could not load the selected images.","wp-banana"));let i;try{i=await window.fetch(s.sourceUrl,{credentials:"same-origin"})}catch(e){throw new Error((0,n.__)("Could not load the selected images.","wp-banana"))}if(!i.ok)throw new Error((0,n.__)("Could not load the selected images.","wp-banana"));const l=await i.blob(),o=l.type||s.mimeType||"image/png",d=p(s.filename,r+1,o),c=new File([l],d,{type:o});e[r]={...s,file:c,mimeType:o},a.push(c),t=!0}return t&&z(e),J.current=e,a},[z]),Ue=(0,t.useCallback)(async(e,a)=>{if(ge>0){let t=[];try{t=await Pe()}catch(e){throw Q((0,n.__)("Could not load the selected images.","wp-banana")),e}const i=new window.FormData;return i.append("prompt",e),i.append("provider",C),A&&i.append("model",A),a&&i.append("preview_only","1"),t.forEach(e=>{i.append("reference_images[]",e,e.name)}),s()({path:`${r}/generate`,method:"POST",body:i})}const t={prompt:e,provider:C};return A&&(t.model=A),we&&T&&(t.aspect_ratio=T),a&&(t.preview_only="1"),s()({path:`${r}/generate`,method:"POST",data:t})},[ge,Pe,Q,C,A,r,we,T]);(0,a.useEffect)(()=>{if(!w)return;const e=e=>{const a=e.dataTransfer?.types;return!!a&&Array.from(a).includes("Files")},a=a=>{e(a)&&(a.preventDefault(),a.stopPropagation(),X.current+=1,Y(!0))},n=a=>{e(a)&&(a.preventDefault(),a.stopPropagation(),a.dataTransfer&&(a.dataTransfer.dropEffect="copy"),Y(!0))},t=()=>{X.current=0,Y(!1)},r=a=>{e(a)&&(a.preventDefault(),a.stopPropagation(),X.current=Math.max(0,X.current-1),0===X.current&&Y(!1))},s=a=>{if(!e(a))return;a.preventDefault(),a.stopPropagation();const n=a.dataTransfer,r=n?Array.from(n.files||[]):[];if(r.length>0&&De(r),n)try{n.clearData()}catch(e){}t()},i=a=>{e(a)&&t()};return window.addEventListener("dragenter",a),window.addEventListener("dragover",n),window.addEventListener("dragleave",r),window.addEventListener("drop",s),window.addEventListener("dragend",i),()=>{window.removeEventListener("dragenter",a),window.removeEventListener("dragover",n),window.removeEventListener("dragleave",r),window.removeEventListener("drop",s),window.removeEventListener("dragend",i),X.current=0,Y(!1)}},[De,w]),(0,a.useEffect)(()=>()=>{ue.current=!0,fe()},[fe]),(0,a.useEffect)(()=>{if("undefined"==typeof document)return;const e=document.body,a="wp-banana-variations-open";return ae?e.classList.add(a):e.classList.remove(a),()=>{e.classList.remove(a)}},[ae]);const Oe=async()=>{const e=R.trim();if(e.length<3)$((0,n.__)("Please enter a longer prompt.","wp-banana"));else if(be&&0===he.length)$((0,n.__)("Choose a model that supports multiple reference images.","wp-banana"));else{$(null),Q(null),I(!0);try{await Ue(e,!1),S(""),we&&F(y),W(!1),je(),d()}catch(e){const a=e;a?.message?$(a.message):e instanceof Error&&e.message?$(e.message):$((0,n.__)("Failed to generate image.","wp-banana"))}finally{I(!1)}}},$e=(0,t.useCallback)(()=>{ue.current=!0,fe(),ne(!1),re([]),ie(null),oe(null),me.current={successes:0,errors:[]},G&&I(!1)},[fe,G]),Ge=(0,t.useCallback)(e=>{0===e.length&&$e()},[$e]),Ie=(0,t.useCallback)(e=>{var a;const t=Math.max(1,Math.min(4,e)),r=R.trim();if(r.length<3)return void $((0,n.__)("Please enter a longer prompt.","wp-banana"));if(be&&0===he.length)return void $((0,n.__)("Choose a model that supports multiple reference images.","wp-banana"));ue.current=!1,fe(),$(null),Q(null),oe(null),me.current={successes:0,errors:[]};const s=Date.now(),i=Array.from({length:t}).map((e,a)=>({id:`${s}-${a}-${Math.random().toString(36).slice(2,10)}`,index:a,status:"queued"}));re(i),ie(null!==(a=i[0]?.id)&&void 0!==a?a:null),ne(!1),I(!0),ee(!1);const l=r,o=i.map((e,a)=>new Promise(t=>{const r=window.setTimeout(async()=>{if(ue.current)t();else{re(a=>a.map(a=>a.id===e.id?{...a,status:"loading"}:a));try{var a,r,s,i,o,d,c;const p=await Ue(l,!0);if(ue.current)return void t();const m=p?.preview,f=null!==(a=p?.context)&&void 0!==a?a:{};if(!m?.data)throw new Error((0,n.__)("Failed to generate image.","wp-banana"));const g={provider:null!==(r=f.provider)&&void 0!==r?r:C,model:f.model,format:null!==(s=f.format)&&void 0!==s?s:u(m.mime),prompt:null!==(i=f.prompt)&&void 0!==i?i:l,filenameBase:null!==(o=null!==(d=f.filename_base)&&void 0!==d?d:f.filenameBase)&&void 0!==o?o:"",title:null!==(c=f.title)&&void 0!==c?c:""};re(a=>a.map(a=>{var n,t;return a.id===e.id?{...a,status:"complete",data:null!==(n=m.data)&&void 0!==n?n:"",mime:null!==(t=m.mime)&&void 0!==t?t:"image/png",width:m.width,height:m.height,bytes:m.bytes,context:g,error:void 0}:a})),me.current.successes+=1,ie(a=>null!=a?a:e.id),ne(e=>e||!0)}catch(a){var p;if(ue.current)return void t();const r=a,s=null!==(p=r?.message)&&void 0!==p?p:(0,n.__)("Failed to generate image.","wp-banana");me.current.errors.push(s),re(a=>a.map(a=>a.id===e.id?{...a,status:"error",error:s}:a)),oe({message:s,type:"error"})}finally{t()}}},1e3*a);pe.current.push(r)}));Promise.all(o).then(()=>{fe(),ue.current||(me.current.successes>0?(S(""),we&&F(y),je(),W(!1)):(ne(!1),re([]),ie(null),me.current.errors.length>0&&$(me.current.errors[0])),I(!1))})},[R,$,be,he,fe,Ue,we,y,je,W,Q,C]),Te=(0,t.useCallback)(e=>{ee(!1),G||Ie(e)},[Ie,G]),Fe=(0,t.useCallback)(async e=>{const a=ce.current.find(a=>a.id===e);if(a&&("complete"===a.status||"error"===a.status)&&a.data&&a.context){oe(null),re(a=>a.map(a=>a.id===e?{...a,status:"saving",error:void 0}:a));try{var t;const i=await s()({path:`${r}/generate/save-preview`,method:"POST",data:{data:a.data,provider:a.context.provider,model:null!==(t=a.context.model)&&void 0!==t?t:"",format:a.context.format,mime:a.mime,prompt:a.context.prompt,filename_base:a.context.filenameBase,title:a.context.title}});re(a=>{const n=a.map(a=>a.id===e?{...a,status:"saved",attachmentId:i?.attachment_id,url:i?.url,error:void 0}:a);return Ge(n),n}),oe({message:(0,n.__)("Image saved to Media Library.","wp-banana"),type:"success"})}catch(a){var i;const t=a,r=null!==(i=t?.message)&&void 0!==i?i:(0,n.__)("Failed to save image.","wp-banana");re(a=>a.map(a=>a.id===e?{...a,status:"error",error:r}:a)),oe({message:r,type:"error"})}}},[r,Ge]),Be=(0,t.useCallback)(e=>{const a=Array.isArray(ce.current)?ce.current:[],t=a.find(a=>a.id===e)||null,r=a.filter(a=>a.id!==e);if(re(r),ce.current=r,0===r.length?ie(null):se===e&&ie(r[0].id),Ge(r),t){const e={...t,status:"complete"};oe({message:(0,n.__)("Deleted.","wp-banana"),type:"warning",undo:e})}else oe({message:(0,n.__)("Deleted.","wp-banana"),type:"warning"})},[se,Ge]),We=(0,t.useCallback)(()=>{const e=le?.undo;e&&(re(a=>{if(a.some(a=>a.id===e.id))return a;const n=[e,...a];return n.sort((e,a)=>e.index-a.index),n}),ie(e.id),ne(!0),oe(null))},[le]),He=(0,t.useCallback)(e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),Ee&&!G&&Oe())},[Ee,G,Oe]),ze=w&&K;return(0,l.jsxs)(l.Fragment,{children:[w&&(0,l.jsx)("div",{className:"uploader-window wp-banana-generate-page__drop-overlay",style:{display:ze?"block":"none",opacity:ze?1:0},"aria-hidden":"true",children:(0,l.jsx)("div",{className:"uploader-window-content",children:(0,l.jsx)("div",{className:"uploader-editor-title",children:(0,n.__)("Drop files to attach","wp-banana")})})}),(0,l.jsx)(i.Card,{children:(0,l.jsxs)(i.CardBody,{children:[P&&(0,l.jsx)(i.Notice,{status:"error",isDismissible:!1,children:P}),O&&(0,l.jsx)(i.Notice,{status:"error",isDismissible:!1,children:O}),q&&(0,l.jsx)(i.Notice,{status:"warning",isDismissible:!1,children:q}),be&&!L&&0===he.length&&(0,l.jsx)(i.Notice,{status:"warning",isDismissible:!1,children:(0,n.__)("Switch to a supported model to send multiple reference images.","wp-banana")}),(0,l.jsxs)("div",{className:"wp-banana-generate-panel__prompt",style:{position:"relative",marginBottom:"8px"},children:[(0,l.jsx)(i.TextareaControl,{label:(0,n.__)("Describe the image","wp-banana"),value:R,onChange:S,onKeyDown:He,rows:5,placeholder:(0,n.__)("A cat surfing a wave at sunset…","wp-banana"),disabled:G}),(0,l.jsx)("button",{type:"button",className:"button button-secondary button-small wp-banana-generate-panel__reference-picker",onClick:Ae,disabled:G,"aria-label":(0,n.__)("Add reference images","wp-banana"),style:{position:"absolute",top:"24px",right:"0",lineHeight:"20px",padding:"0 4px",border:"none",borderRadius:0,background:"transparent"},children:(0,l.jsx)("span",{className:"dashicons dashicons-paperclip","aria-hidden":"true"})}),(0,l.jsx)("input",{ref:V,type:"file",accept:"image/png,image/jpeg,image/webp",multiple:!0,onChange:Le,style:{display:"none"}})]}),H.length>0&&(0,l.jsx)("div",{className:"wp-banana-generate-panel__reference-list",style:{display:"flex",gap:"8px",marginBottom:"16px",flexWrap:"wrap"},children:H.map(e=>(0,l.jsxs)("div",{style:{position:"relative",width:"72px",height:"72px",overflow:"hidden",borderRadius:"4px",border:"1px solid #dcdcde"},children:[(0,l.jsx)("img",{src:e.url,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,l.jsx)("button",{type:"button",className:"button-link wp-banana-generate-panel__reference-remove",onClick:()=>Me(e.id),"aria-label":(0,n.__)("Remove reference image","wp-banana"),style:{position:"absolute",top:"2px",right:"2px",display:"inline-flex",alignItems:"center",justifyContent:"center",width:"22px",height:"22px",background:"rgba(0,0,0,0.55)",color:"#fff",borderRadius:"3px",textDecoration:"none"},children:(0,l.jsx)("span",{className:"dashicons dashicons-no"})})]},e.id))}),B&&x.length>1&&(0,l.jsx)(i.SelectControl,{label:(0,n.__)("Provider","wp-banana"),value:C,onChange:e=>k(e),options:x.map(e=>({label:e.label,value:e.slug})),disabled:G}),B&&(0,l.jsx)(i.SelectControl,{label:(0,n.__)("Model","wp-banana"),value:A,onChange:e=>D(e),disabled:L||0===he.length||G,options:he.length>0?he.map(e=>({label:e,value:e})):[{label:(0,n.__)("No models available","wp-banana"),value:""}]}),B&&we&&(0,l.jsx)(i.SelectControl,{label:(0,n.__)("Aspect ratio","wp-banana"),value:T,onChange:e=>F(e),disabled:G,options:_.map(e=>({label:e,value:e}))}),L&&(0,l.jsxs)("div",{className:"wp-banana-generate-panel__spinner",style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)(i.Spinner,{})," ",(0,n.__)("Loading models…","wp-banana")]}),(0,l.jsxs)("div",{className:"wp-banana-generate-panel__actions",style:{marginTop:"16px",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"12px",justifyContent:"space-between"},children:[(0,l.jsxs)("div",{ref:de,style:{display:"flex",alignItems:"center",gap:"12px",position:"relative",zIndex:1e3},children:[(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{type:"button",className:"button button-primary wp-banana-generate-panel__submit",onClick:Oe,disabled:!Ee||G,title:(0,n.__)("Generate one image and save to Media Library","wp-banana"),children:(0,n.__)("Generate Image","wp-banana")}),(0,l.jsx)("button",{type:"button",className:"button button-primary",onClick:()=>{G||ee(e=>!e)},disabled:G||!Ee,"aria-haspopup":"menu","aria-expanded":Z,"aria-label":(0,n.__)("Generate multiple variations","wp-banana"),style:{padding:"0 4px"},title:(0,n.__)("Generate multiple variations and preview before saving","wp-banana"),children:(0,l.jsx)("span",{className:"dashicons dashicons-arrow-down-alt2","aria-hidden":"true",style:{lineHeight:"30px"}})})]}),G&&(0,l.jsx)("span",{className:"spinner is-active","aria-hidden":"true"}),Z&&(0,l.jsxs)("div",{className:"wp-banana-generate-panel__variation-menu",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:"4px",background:"#fff",border:"1px solid #dcdcde",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:10,minWidth:"180px",padding:"4px 0"},children:[c.map(e=>(0,l.jsxs)("button",{type:"button",role:"menuitem",className:"button button-link",style:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",padding:"6px 12px",boxSizing:"border-box",textDecoration:"none"},onClick:()=>Te(e),children:[(0,l.jsx)("span",{children:(0,n.sprintf)((0,n._n)("%d image","%d images",e,"wp-banana"),e)}),1===e&&(0,l.jsx)("span",{className:"dashicons dashicons-format-image","aria-hidden":"true"}),e>1&&(0,l.jsx)("span",{className:"dashicons dashicons-images-alt2","aria-hidden":"true"})]},e)),(0,l.jsx)("span",{style:{display:"block",padding:"4px 12px 2px",fontSize:"11px",fontWeight:"400",color:"#555d66",borderTop:"1px solid #e1e1e1"},children:(0,n.__)("Generate and Preview Images","wp-banana")})]})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap",textAlign:"right"},children:[Se.fallback?(0,l.jsx)("span",{children:Se.fallback}):(0,l.jsxs)("span",{children:[Se.aspect&&(0,l.jsxs)("span",{children:[Se.aspect," — "]}),(0,l.jsx)("code",{children:Se.model}),Se.provider&&(0,l.jsxs)("span",{children:[" (",Se.provider,")"]}),Se.references&&(0,l.jsxs)("span",{children:[" - ",Se.references]})]}),(0,l.jsx)("button",{type:"button",className:"button-link",onClick:()=>W(!B),children:B?(0,n.__)("Hide options","wp-banana"):(0,n.__)("Change","wp-banana")})]})]})]})}),ae&&(0,l.jsxs)(i.Modal,{className:"wp-banana-generate-variations-modal",title:(0,n.__)("Generated Variations","wp-banana"),onRequestClose:$e,children:[le&&"success"!==le.type&&(0,l.jsx)("div",{style:{marginBottom:"16px"},children:(0,l.jsx)(i.Notice,{status:"warning"===le.type?"warning":"error",isDismissible:!1,children:(0,l.jsxs)("div",{className:"wp-banana-generate-variations-modal__notice",style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[(0,l.jsx)("span",{children:le.message}),le.undo?(0,l.jsx)(i.Button,{variant:"link",onClick:We,children:(0,n.__)("Undo","wp-banana")}):null]})})}),(0,l.jsxs)("div",{className:"wp-banana-generate-variations-modal__layout",style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:[(0,l.jsx)("div",{className:"wp-banana-generate-variations-modal__list",style:{width:"200px",maxHeight:"420px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"8px"},children:te.map(e=>{const a=e.id===ve?.id,t=e.data&&e.mime?`data:${e.mime};base64,${e.data}`:"";return(0,l.jsxs)("button",{type:"button",onClick:()=>ie(e.id),className:"button button-link",style:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:"6px",padding:"6px",border:a?"2px solid #007cba":"1px solid #dcdcde",borderRadius:"4px",background:a?"#f0f6fc":"#fff",textAlign:"left",textDecoration:"none",boxShadow:"none"},children:[(0,l.jsxs)("div",{style:{position:"relative",height:"64px",background:"#f6f7f7",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",borderRadius:"3px"},children:["complete"===e.status||"saved"===e.status||"error"===e.status?t?(0,l.jsx)("img",{src:t,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,l.jsx)("span",{children:(0,n.__)("Preview unavailable","wp-banana")}):(0,l.jsx)(i.Spinner,{}),"saved"===e.status&&(0,l.jsx)("span",{style:{position:"absolute",top:"4px",right:"4px",background:"#007cba",color:"#fff",padding:"2px 6px",borderRadius:"3px",fontSize:"11px",fontWeight:600},children:(0,n.__)("Saved","wp-banana")})]}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[(0,l.jsx)("strong",{children:(0,n.sprintf)((0,n.__)("Variation %d","wp-banana"),e.index+1)}),(0,l.jsx)("span",{style:{fontSize:"12px",color:"#555"},children:m(e.status)})]})]},e.id)})}),(0,l.jsxs)("div",{className:"wp-banana-generate-variations-modal__preview",style:{flex:1,minWidth:"260px",display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsx)("div",{style:{position:"relative",background:"#f6f7f7",border:"1px solid #dcdcde",borderRadius:"4px",minHeight:"300px",display:"flex",alignItems:"center",justifyContent:"center",padding:"12px"},children:ve?"loading"===ve.status||"queued"===ve.status?(0,l.jsx)(i.Spinner,{}):"error"===ve.status?(0,l.jsx)(i.Notice,{status:"error",isDismissible:!1,children:null!==(v=ve.error)&&void 0!==v?v:(0,n.__)("Failed to generate image.","wp-banana")}):(0,l.jsxs)(l.Fragment,{children:[xe?(0,l.jsx)("img",{src:xe,alt:"",style:{maxWidth:"100%",maxHeight:"360px",borderRadius:"4px",objectFit:"contain"}}):(0,l.jsx)("span",{children:(0,n.__)("Preview unavailable","wp-banana")}),"saving"===ve.status&&(0,l.jsxs)("div",{style:{position:"absolute",inset:0,background:"rgba(255,255,255,0.7)",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,l.jsx)(i.Spinner,{})," ",(0,n.__)("Saving…","wp-banana")]})]}):(0,l.jsx)("span",{children:(0,n.__)("No preview selected.","wp-banana")})}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,l.jsx)(i.Button,{isPrimary:!0,onClick:ve?()=>Fe(ve.id):void 0,disabled:!_e||"saving"===ve?.status,children:(0,n.__)("Save","wp-banana")}),(0,l.jsx)(i.Button,{variant:"secondary",onClick:ve?()=>Be(ve.id):void 0,disabled:!ye||"saving"===ve?.status,children:(0,n.__)("Discard","wp-banana")})]})]})]})]})]})};let g=null;const b=e=>{e.innerHTML="";const a=document.createElement("div");a.className="notice notice-warning";const t=document.createElement("p");t.textContent=(0,n.__)("No connected providers available. Add a key in Settings → AI Images.","wp-banana"),a.appendChild(t),e.appendChild(a)},h=()=>{const e=document.getElementById("wp-banana-generate-page");if(!e)return;const n=window.wpBananaGeneratePage;if(!n||!Array.isArray(n.providers))return void b(e);const t=n.providers.filter(e=>!1!==e.connected);0!==t.length?((e,n)=>{const t=window.wp?.element,r=()=>{n.redirectUrl?window.location.href=n.redirectUrl:window.location.reload()};if("function"==typeof t?.createRoot)return g||(g=t.createRoot(e)),void g.render((0,l.jsx)(f,{providers:n.providers,restNamespace:n.restNamespace,onComplete:r,defaultGeneratorModel:n.defaultGeneratorModel,defaultGeneratorProvider:n.defaultGeneratorProvider,defaultAspectRatio:n.defaultAspectRatio,aspectRatioOptions:n.aspectRatioOptions,enableReferenceDragDrop:!0}));(0,a.render)((0,l.jsx)(f,{providers:n.providers,restNamespace:n.restNamespace,onComplete:r,defaultGeneratorModel:n.defaultGeneratorModel,defaultGeneratorProvider:n.defaultGeneratorProvider,defaultAspectRatio:n.defaultAspectRatio,aspectRatioOptions:n.aspectRatioOptions,enableReferenceDragDrop:!0}),e)})(e,{restNamespace:n.restNamespace,providers:t,redirectUrl:n.redirectUrl,defaultGeneratorModel:n.defaultGeneratorModel,defaultGeneratorProvider:n.defaultGeneratorProvider,defaultAspectRatio:n.defaultAspectRatio,aspectRatioOptions:n.aspectRatioOptions}):b(e)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()})();
(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.element,t=window.wp.i18n,n=window.React,r=window.wp.apiFetch;var s=e.n(r);const i=window.wp.components,l=window.ReactJSXRuntime,o={gemini:["gemini-2.5-flash-image-preview","gemini-2.5-flash-image"],openai:["gpt-image-1","gpt-image-1-mini"],replicate:["google/nano-banana","bytedance/seedream-4","reve/remix"]},d={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp"},c=[1,2,3,4],p=(e,a,t)=>{var n;const r=`reference-${a}`,s=e&&e.trim().length>0?e.trim():r,i=null!==(n=d[t.toLowerCase()])&&void 0!==n?n:"";if(""===i)return s;if(s.toLowerCase().endsWith(`.${i}`))return s;const l=s.lastIndexOf(".");return l>0?`${s.slice(0,l)}.${i}`:`${s}.${i}`},u=e=>{if(!e)return"png";const a=d[e.toLowerCase()];return null!=a?a:"png"},m=e=>{switch(e){case"queued":case"loading":return(0,t.__)("Generating…","wp-banana");case"complete":return(0,t.__)("Ready","wp-banana");case"saving":return(0,t.__)("Saving…","wp-banana");case"saved":return(0,t.__)("Saved","wp-banana");case"error":return(0,t.__)("Failed","wp-banana");default:return""}},f=({providers:e,restNamespace:r,onComplete:d,defaultGeneratorModel:f,defaultGeneratorProvider:g,aspectRatioOptions:h,defaultAspectRatio:w,enableReferenceDragDrop:b=!1})=>{var v;const x=(0,a.useMemo)(()=>e.filter(e=>!1!==e.connected),[e]),y=(0,a.useMemo)(()=>Array.isArray(h)?h.map(e=>"string"==typeof e?e.trim().toUpperCase():"").filter(e=>e.length>0):[],[h]),_=(0,a.useMemo)(()=>{var e;if("string"==typeof w){const e=w.trim().toUpperCase();if(e&&y.includes(e))return e}return null!==(e=y[0])&&void 0!==e?e:""},[y,w]),j=(0,a.useMemo)(()=>{var a;if(g){const e=x.find(e=>e.slug===g);if(e)return e.slug}if(f){const a=x.find(e=>e.default_model===f);if(a)return a.slug;const t=e.find(e=>e.default_model===f);if(t){const e=x.find(e=>e.slug===t.slug);if(e)return e.slug}}return x.length>0?x[0].slug:null!==(a=e[0]?.slug)&&void 0!==a?a:""},[x,e,g,f]),[C,k]=(0,a.useState)(j),[R,S]=(0,a.useState)(""),[E,N]=(0,a.useState)([]),[A,D]=(0,a.useState)(""),[L,M]=(0,a.useState)(!1),[P,U]=(0,a.useState)(null),[O,$]=(0,a.useState)(null),[G,I]=(0,a.useState)(!1),[F,T]=(0,a.useState)(_),[B,W]=(0,a.useState)(!1),[H,q]=(0,a.useState)([]),[z,Q]=(0,a.useState)(null),[K,Y]=(0,a.useState)(!1),V=(0,n.useRef)(null),J=(0,n.useRef)(H),X=(0,n.useRef)(0),[Z,ee]=(0,a.useState)(!1),[ae,te]=(0,a.useState)(!1),[ne,re]=(0,a.useState)([]),[se,ie]=(0,a.useState)(null),[le,oe]=(0,a.useState)(null),de=(0,n.useRef)(null),ce=(0,n.useRef)([]),pe=(0,n.useRef)([]),ue=(0,n.useRef)(!1),me=(0,n.useRef)({successes:0,errors:[]}),fe=(0,n.useCallback)(()=>{0!==pe.current.length&&(pe.current.forEach(e=>window.clearTimeout(e)),pe.current=[])},[]),ge=H.length,he=ge>1,we=(0,a.useMemo)(()=>{var e;if(!he)return E;const a=null!==(e=o[C])&&void 0!==e?e:[];if(0===a.length)return[];const t=new Set(a);return E.filter(e=>t.has(e))},[E,he,C]),be=0===ge&&y.length>0,ve=(0,a.useMemo)(()=>{if(0===ne.length)return null;const e=ne.find(e=>e.id===se);return null!=e?e:ne[0]},[ne,se]),xe=ve&&ve.data&&ve.mime?`data:${ve.mime};base64,${ve.data}`:"",ye=!!ve&&("complete"===ve.status||"error"===ve.status),_e=!!ve&&"saving"!==ve.status&&"saved"!==ve.status;(0,a.useEffect)(()=>{J.current=H},[H]),(0,a.useEffect)(()=>{ce.current=ne},[ne]),(0,a.useEffect)(()=>{0!==ne.length?ne.some(e=>e.id===se)||ie(ne[0].id):null!==se&&ie(null)},[ne,se]),(0,a.useEffect)(()=>{if(!Z)return;const e=e=>{de.current&&e.target instanceof Node&&!de.current.contains(e.target)&&ee(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[Z]),(0,a.useEffect)(()=>()=>{J.current.forEach(e=>{e.revokeOnCleanup&&e.url&&window.URL.revokeObjectURL(e.url)})},[]);const je=(0,n.useCallback)(()=>{J.current.forEach(e=>{e.revokeOnCleanup&&e.url&&window.URL.revokeObjectURL(e.url)}),q([]),Q(null)},[]),Ce=(0,n.useCallback)(e=>{if(S(""),$(null),je(),!Array.isArray(e)||0===e.length)return;const a=[];e.slice(0,4).forEach(e=>{if(!e.sourceUrl||0===e.sourceUrl.length)return;const t=`${Date.now()}-${Math.random().toString(36).slice(2)}`,n=e.sourceUrl,r=e.previewUrl&&e.previewUrl.length>0?e.previewUrl:n;a.push({id:t,url:r,sourceUrl:n,filename:e.filename,mimeType:e.mime})}),q(a),J.current=a,e.length>4&&Q((0,t.__)("Only the first 4 selected images were attached as references.","wp-banana"))},[je]);(0,a.useEffect)(()=>{const e=e=>{if(!e)return;const a=window,t=a.wpBananaReferenceQueue;if(!Array.isArray(t)||0===t.length)return;const n=t.indexOf(e);n>=0&&t.splice(n,1),0===t.length&&delete a.wpBananaReferenceQueue},a=a=>{const t=a,n=t.detail?.references;Array.isArray(n)&&0!==n.length?(e(n),Ce(n)):e(n)};return(()=>{const e=window,a=e.wpBananaReferenceQueue;if(Array.isArray(a)&&0!==a.length){for(;a.length>0;){const e=a.shift();Array.isArray(e)&&e.length>0&&Ce(e)}delete e.wpBananaReferenceQueue}})(),window.addEventListener("wp-banana:set-reference-images",a),()=>{window.removeEventListener("wp-banana:set-reference-images",a)}},[Ce]),(0,a.useEffect)(()=>{ge>0?""!==F&&T(""):0!==y.length?y.includes(F)||_!==F&&T(_):""!==F&&T("")},[y,F,_,ge]);const ke=(0,a.useMemo)(()=>e.find(e=>e.slug===C),[C,e]),Re=(0,a.useMemo)(()=>{var a;if(ke?.label)return ke.label;const t=e.find(e=>e.slug===C);return null!==(a=t?.label)&&void 0!==a?a:C?C.toUpperCase():""},[C,e,ke]),Se=(0,a.useMemo)(()=>{const e=be?F||(0,t.__)("Default aspect ratio","wp-banana"):"",a=ke?.default_model?String(ke.default_model):"";let n=A||(L?(0,t.__)("Loading model…","wp-banana"):""!==a?a:(0,t.__)("Provider default model","wp-banana"));he&&0===we.length&&(n=(0,t.__)("No compatible model","wp-banana"));const r=Re,s=ge>0?(0,t.sprintf)((0,t._n)("%d reference","%d references",ge,"wp-banana"),ge):"";return{aspect:e,model:n,provider:r,references:s,fallback:e||n||r||s?"":(0,t.__)("Using provider defaults","wp-banana")}},[be,F,A,L,Re,ke,he,we,ge]);(0,a.useEffect)(()=>{C&&x.some(e=>e.slug===C)||j&&k(j)},[j,C,x]),(0,a.useEffect)(()=>{if(!C)return;const e=ge>0?"edit":"generate";let a=!0;return M(!0),U(null),s()({path:`${r}/models?provider=${C}&purpose=${e}`}).then(e=>{if(!a)return;const t=e,n=Array.isArray(t.models)?t.models:[];if(N(n),0===n.length)return void D("");const r=(ge>0?[ke?.default_model]:[f,ke?.default_model]).find(e=>!!e&&n.includes(e));D(r||n[0])}).catch(e=>{var n;a&&(N([]),D(""),U(null!==(n=e?.message)&&void 0!==n?n:(0,t.__)("Failed to load models.","wp-banana")))}).finally(()=>{a&&M(!1)}),()=>{a=!1}},[C,r,ke,f,ge]),(0,a.useEffect)(()=>{L||(0!==we.length?we.includes(A)||D(we[0]):he&&""!==A&&D(""))},[we,A,L,he]);const Ee=(0,a.useMemo)(()=>we.length>0?""!==A&&we.includes(A):!he&&(""!==A||0===E.length),[we,A,he,E]),Ne=(0,a.useMemo)(()=>!(G||L||R.trim().length<3||""===C||!Ee||be&&""===F),[G,L,R,C,Ee,be,F]),Ae=(0,n.useCallback)(()=>{V.current&&V.current.click()},[]),De=(0,n.useCallback)(e=>{if(!Array.isArray(e)||0===e.length)return;const a=Array.isArray(J.current)?J.current:[];let n=Math.max(0,4-a.length),r=0,s=0;const i=[];if(e.forEach(e=>{if(!e?.type||!e.type.startsWith("image/"))return;if(s+=1,n<=0)return;const a=`${Date.now()}-${Math.random().toString(36).slice(2)}`,t=window.URL.createObjectURL(e);i.push({id:a,file:e,url:t,revokeOnCleanup:!0,filename:e.name,mimeType:e.type}),n-=1,r+=1}),r>0){const e=[...a,...i];J.current=e,q(e),$(null),Q(s>r?(0,t.__)("You can upload up to 4 reference images.","wp-banana"):null)}else s>0&&Q((0,t.__)("You can upload up to 4 reference images.","wp-banana"))},[q,$,Q]),Le=(0,n.useCallback)(e=>{const a=e.target.files;a&&a.length>0&&De(Array.from(a)),e.target.value=""},[De]),Me=(0,n.useCallback)(e=>{const a=H.filter(a=>a.id!==e||(a.revokeOnCleanup&&a.url&&window.URL.revokeObjectURL(a.url),!1));q(a),Q(null)},[H]),Pe=(0,n.useCallback)(async()=>{const e=Array.isArray(J.current)?[...J.current]:[],a=[];let n=!1;for(let r=0;r<e.length;r+=1){const s=e[r];if(s.file instanceof File){a.push(s.file);continue}if(!s.sourceUrl)throw new Error((0,t.__)("Could not load the selected images.","wp-banana"));let i;try{i=await window.fetch(s.sourceUrl,{credentials:"same-origin"})}catch(e){throw new Error((0,t.__)("Could not load the selected images.","wp-banana"))}if(!i.ok)throw new Error((0,t.__)("Could not load the selected images.","wp-banana"));const l=await i.blob(),o=l.type||s.mimeType||"image/png",d=p(s.filename,r+1,o),c=new File([l],d,{type:o});e[r]={...s,file:c,mimeType:o},a.push(c),n=!0}return n&&q(e),J.current=e,a},[q]),Ue=(0,n.useCallback)(async(e,a)=>{if(ge>0){let n=[];try{n=await Pe()}catch(e){throw Q((0,t.__)("Could not load the selected images.","wp-banana")),e}const i=new window.FormData;return i.append("prompt",e),i.append("provider",C),A&&i.append("model",A),a&&i.append("preview_only","1"),n.forEach(e=>{i.append("reference_images[]",e,e.name)}),s()({path:`${r}/generate`,method:"POST",body:i})}const n={prompt:e,provider:C};return A&&(n.model=A),be&&F&&(n.aspect_ratio=F),a&&(n.preview_only="1"),s()({path:`${r}/generate`,method:"POST",data:n})},[ge,Pe,Q,C,A,r,be,F]);(0,a.useEffect)(()=>{if(!b)return;const e=e=>{const a=e.dataTransfer?.types;return!!a&&Array.from(a).includes("Files")},a=a=>{e(a)&&(a.preventDefault(),a.stopPropagation(),X.current+=1,Y(!0))},t=a=>{e(a)&&(a.preventDefault(),a.stopPropagation(),a.dataTransfer&&(a.dataTransfer.dropEffect="copy"),Y(!0))},n=()=>{X.current=0,Y(!1)},r=a=>{e(a)&&(a.preventDefault(),a.stopPropagation(),X.current=Math.max(0,X.current-1),0===X.current&&Y(!1))},s=a=>{if(!e(a))return;a.preventDefault(),a.stopPropagation();const t=a.dataTransfer,r=t?Array.from(t.files||[]):[];if(r.length>0&&De(r),t)try{t.clearData()}catch(e){}n()},i=a=>{e(a)&&n()};return window.addEventListener("dragenter",a),window.addEventListener("dragover",t),window.addEventListener("dragleave",r),window.addEventListener("drop",s),window.addEventListener("dragend",i),()=>{window.removeEventListener("dragenter",a),window.removeEventListener("dragover",t),window.removeEventListener("dragleave",r),window.removeEventListener("drop",s),window.removeEventListener("dragend",i),X.current=0,Y(!1)}},[De,b]),(0,a.useEffect)(()=>()=>{ue.current=!0,fe()},[fe]),(0,a.useEffect)(()=>{if("undefined"==typeof document)return;const e=document.body,a="wp-banana-variations-open";return ae?e.classList.add(a):e.classList.remove(a),()=>{e.classList.remove(a)}},[ae]);const Oe=async()=>{const e=R.trim();if(e.length<3)$((0,t.__)("Please enter a longer prompt.","wp-banana"));else if(he&&0===we.length)$((0,t.__)("Choose a model that supports multiple reference images.","wp-banana"));else{$(null),Q(null),I(!0);try{await Ue(e,!1),S(""),be&&T(_),W(!1),je(),d()}catch(e){const a=e;a?.message?$(a.message):e instanceof Error&&e.message?$(e.message):$((0,t.__)("Failed to generate image.","wp-banana"))}finally{I(!1)}}},$e=(0,n.useCallback)(()=>{ue.current=!0,fe(),te(!1),re([]),ie(null),oe(null),me.current={successes:0,errors:[]},G&&I(!1)},[fe,G]),Ge=(0,n.useCallback)(e=>{0!==e.length?e.every(e=>"saved"===e.status)&&$e():$e()},[$e]),Ie=(0,n.useCallback)(e=>{var a;const n=Math.max(1,Math.min(4,e)),r=R.trim();if(r.length<3)return void $((0,t.__)("Please enter a longer prompt.","wp-banana"));if(he&&0===we.length)return void $((0,t.__)("Choose a model that supports multiple reference images.","wp-banana"));ue.current=!1,fe(),$(null),Q(null),oe(null),me.current={successes:0,errors:[]};const s=Date.now(),i=Array.from({length:n}).map((e,a)=>({id:`${s}-${a}-${Math.random().toString(36).slice(2,10)}`,index:a,status:"queued"}));re(i),ie(null!==(a=i[0]?.id)&&void 0!==a?a:null),te(!1),I(!0),ee(!1);const l=r,o=i.map((e,a)=>new Promise(n=>{const r=window.setTimeout(async()=>{if(ue.current)n();else{re(a=>a.map(a=>a.id===e.id?{...a,status:"loading"}:a));try{var a,r,s,i,o,d,c;const p=await Ue(l,!0);if(ue.current)return void n();const m=p?.preview,f=null!==(a=p?.context)&&void 0!==a?a:{};if(!m?.data)throw new Error((0,t.__)("Failed to generate image.","wp-banana"));const g={provider:null!==(r=f.provider)&&void 0!==r?r:C,model:f.model,format:null!==(s=f.format)&&void 0!==s?s:u(m.mime),prompt:null!==(i=f.prompt)&&void 0!==i?i:l,filenameBase:null!==(o=null!==(d=f.filename_base)&&void 0!==d?d:f.filenameBase)&&void 0!==o?o:"",title:null!==(c=f.title)&&void 0!==c?c:""};re(a=>a.map(a=>{var t,n;return a.id===e.id?{...a,status:"complete",data:null!==(t=m.data)&&void 0!==t?t:"",mime:null!==(n=m.mime)&&void 0!==n?n:"image/png",width:m.width,height:m.height,bytes:m.bytes,context:g,error:void 0}:a})),me.current.successes+=1,ie(a=>null!=a?a:e.id),te(e=>e||!0)}catch(a){var p;if(ue.current)return void n();const r=a,s=null!==(p=r?.message)&&void 0!==p?p:(0,t.__)("Failed to generate image.","wp-banana");me.current.errors.push(s),re(a=>a.map(a=>a.id===e.id?{...a,status:"error",error:s}:a)),oe({message:s,type:"error"})}finally{n()}}},1e3*a);pe.current.push(r)}));Promise.all(o).then(()=>{fe(),ue.current||(me.current.successes>0?(S(""),be&&T(_),je(),W(!1)):(te(!1),re([]),ie(null),me.current.errors.length>0&&$(me.current.errors[0])),I(!1))})},[R,$,he,we,fe,Ue,be,_,je,W,Q,C]),Fe=(0,n.useCallback)(e=>{ee(!1),G||Ie(e)},[Ie,G]),Te=(0,n.useCallback)(async e=>{const a=ce.current.find(a=>a.id===e);if(a&&("complete"===a.status||"error"===a.status)&&a.data&&a.context){oe(null),re(a=>a.map(a=>a.id===e?{...a,status:"saving",error:void 0}:a));try{var n;const i=await s()({path:`${r}/generate/save-preview`,method:"POST",data:{data:a.data,provider:a.context.provider,model:null!==(n=a.context.model)&&void 0!==n?n:"",format:a.context.format,mime:a.mime,prompt:a.context.prompt,filename_base:a.context.filenameBase,title:a.context.title}});re(a=>{const t=a.map(a=>a.id===e?{...a,status:"saved",attachmentId:i?.attachment_id,url:i?.url,error:void 0}:a);return Ge(t),t}),oe({message:(0,t.__)("Image saved to Media Library.","wp-banana"),type:"success"})}catch(a){var i;const n=a,r=null!==(i=n?.message)&&void 0!==i?i:(0,t.__)("Failed to save image.","wp-banana");re(a=>a.map(a=>a.id===e?{...a,status:"error",error:r}:a)),oe({message:r,type:"error"})}}},[r,Ge]),Be=(0,n.useCallback)(e=>{let a=null,n=[];re(t=>(n=t.filter(t=>t.id!==e||(a=t,!1)),0===n.length?ie(null):se===e&&ie(n[0].id),n)),Ge(n);const r=a;if(r){const e={...r,status:"complete"};oe({message:(0,t.__)("Deleted.","wp-banana"),type:"warning",undo:e})}else oe({message:(0,t.__)("Deleted.","wp-banana"),type:"warning"})},[se,Ge]),We=(0,n.useCallback)(()=>{const e=le?.undo;e&&(re(a=>{if(a.some(a=>a.id===e.id))return a;const t=[e,...a];return t.sort((e,a)=>e.index-a.index),t}),ie(e.id),te(!0),oe(null))},[le]),He=(0,n.useCallback)(e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),Ne&&!G&&Oe())},[Ne,G,Oe]),qe=b&&K;return(0,l.jsxs)(l.Fragment,{children:[b&&(0,l.jsx)("div",{className:"uploader-window wp-banana-generate-page__drop-overlay",style:{display:qe?"block":"none",opacity:qe?1:0},"aria-hidden":"true",children:(0,l.jsx)("div",{className:"uploader-window-content",children:(0,l.jsx)("div",{className:"uploader-editor-title",children:(0,t.__)("Drop files to attach","wp-banana")})})}),(0,l.jsx)(i.Card,{children:(0,l.jsxs)(i.CardBody,{children:[P&&(0,l.jsx)(i.Notice,{status:"error",isDismissible:!1,children:P}),O&&(0,l.jsx)(i.Notice,{status:"error",isDismissible:!1,children:O}),z&&(0,l.jsx)(i.Notice,{status:"warning",isDismissible:!1,children:z}),he&&!L&&0===we.length&&(0,l.jsx)(i.Notice,{status:"warning",isDismissible:!1,children:(0,t.__)("Switch to a supported model to send multiple reference images.","wp-banana")}),(0,l.jsxs)("div",{className:"wp-banana-generate-panel__prompt",style:{position:"relative",marginBottom:"8px"},children:[(0,l.jsx)(i.TextareaControl,{label:(0,t.__)("Describe the image","wp-banana"),value:R,onChange:S,onKeyDown:He,rows:5,placeholder:(0,t.__)("A cat surfing a wave at sunset…","wp-banana"),disabled:G}),(0,l.jsx)("button",{type:"button",className:"button button-secondary button-small wp-banana-generate-panel__reference-picker",onClick:Ae,disabled:G,"aria-label":(0,t.__)("Add reference images","wp-banana"),style:{position:"absolute",top:"24px",right:"0",lineHeight:"20px",padding:"0 4px",border:"none",borderRadius:0,background:"transparent"},children:(0,l.jsx)("span",{className:"dashicons dashicons-paperclip","aria-hidden":"true"})}),(0,l.jsx)("input",{ref:V,type:"file",accept:"image/png,image/jpeg,image/webp",multiple:!0,onChange:Le,style:{display:"none"}})]}),H.length>0&&(0,l.jsx)("div",{className:"wp-banana-generate-panel__reference-list",style:{display:"flex",gap:"8px",marginBottom:"16px",flexWrap:"wrap"},children:H.map(e=>(0,l.jsxs)("div",{style:{position:"relative",width:"72px",height:"72px",overflow:"hidden",borderRadius:"4px",border:"1px solid #dcdcde"},children:[(0,l.jsx)("img",{src:e.url,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,l.jsx)("button",{type:"button",className:"button-link wp-banana-generate-panel__reference-remove",onClick:()=>Me(e.id),"aria-label":(0,t.__)("Remove reference image","wp-banana"),style:{position:"absolute",top:"2px",right:"2px",display:"inline-flex",alignItems:"center",justifyContent:"center",width:"22px",height:"22px",background:"rgba(0,0,0,0.55)",color:"#fff",borderRadius:"3px",textDecoration:"none"},children:(0,l.jsx)("span",{className:"dashicons dashicons-no"})})]},e.id))}),B&&x.length>1&&(0,l.jsx)(i.SelectControl,{label:(0,t.__)("Provider","wp-banana"),value:C,onChange:e=>k(e),options:x.map(e=>({label:e.label,value:e.slug})),disabled:G}),B&&(0,l.jsx)(i.SelectControl,{label:(0,t.__)("Model","wp-banana"),value:A,onChange:e=>D(e),disabled:L||0===we.length||G,options:we.length>0?we.map(e=>({label:e,value:e})):[{label:(0,t.__)("No models available","wp-banana"),value:""}]}),B&&be&&(0,l.jsx)(i.SelectControl,{label:(0,t.__)("Aspect ratio","wp-banana"),value:F,onChange:e=>T(e),disabled:G,options:y.map(e=>({label:e,value:e}))}),L&&(0,l.jsxs)("div",{className:"wp-banana-generate-panel__spinner",style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,l.jsx)(i.Spinner,{})," ",(0,t.__)("Loading models…","wp-banana")]}),(0,l.jsxs)("div",{className:"wp-banana-generate-panel__actions",style:{marginTop:"16px",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"12px",justifyContent:"space-between"},children:[(0,l.jsxs)("div",{ref:de,style:{display:"flex",alignItems:"center",gap:"12px",position:"relative"},children:[(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{type:"button",className:"button button-primary wp-banana-generate-panel__submit",onClick:Oe,disabled:!Ne||G,children:(0,t.__)("Generate Image","wp-banana")}),(0,l.jsx)("button",{type:"button",className:"button button-primary",onClick:()=>{G||ee(e=>!e)},disabled:G||!Ne,"aria-haspopup":"menu","aria-expanded":Z,"aria-label":(0,t.__)("Generate multiple variations","wp-banana"),style:{padding:"0 4px"},children:(0,l.jsx)("span",{className:"dashicons dashicons-arrow-down-alt2","aria-hidden":"true",style:{lineHeight:"30px"}})})]}),G&&(0,l.jsx)("span",{className:"spinner is-active","aria-hidden":"true"}),Z&&(0,l.jsx)("div",{className:"wp-banana-generate-panel__variation-menu",role:"menu",style:{position:"absolute",top:"100%",right:0,marginTop:"4px",background:"#fff",border:"1px solid #dcdcde",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:10,minWidth:"180px",padding:"4px 0"},children:c.map(e=>(0,l.jsxs)("button",{type:"button",role:"menuitem",className:"button button-link",style:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center",padding:"6px 12px",boxSizing:"border-box",textDecoration:"none"},onClick:()=>Fe(e),children:[(0,l.jsx)("span",{children:(0,t.sprintf)((0,t._n)("%d image","%d images",e,"wp-banana"),e)}),e>1&&(0,l.jsx)("span",{className:"dashicons dashicons-image-filter","aria-hidden":"true"})]},e))})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap",textAlign:"right"},children:[Se.fallback?(0,l.jsx)("span",{children:Se.fallback}):(0,l.jsxs)("span",{children:[Se.aspect&&(0,l.jsxs)("span",{children:[Se.aspect," — "]}),(0,l.jsx)("code",{children:Se.model}),Se.provider&&(0,l.jsxs)("span",{children:[" (",Se.provider,")"]}),Se.references&&(0,l.jsxs)("span",{children:[" - ",Se.references]})]}),(0,l.jsx)("button",{type:"button",className:"button-link",onClick:()=>W(!B),children:B?(0,t.__)("Hide options","wp-banana"):(0,t.__)("Change","wp-banana")})]})]})]})}),ae&&(0,l.jsxs)(i.Modal,{className:"wp-banana-generate-variations-modal",title:(0,t.__)("Generated Variations","wp-banana"),onRequestClose:$e,children:[le&&(0,l.jsxs)(i.Notice,{status:"success"===le.type?"success":"warning"===le.type?"warning":"error",isDismissible:!1,style:{marginBottom:"16px"},children:[(0,l.jsx)("span",{children:le.message}),le.undo&&(0,l.jsx)(i.Button,{variant:"link",onClick:We,style:{marginLeft:"8px"},children:(0,t.__)("Undo","wp-banana")})]}),(0,l.jsxs)("div",{className:"wp-banana-generate-variations-modal__layout",style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:[(0,l.jsx)("div",{className:"wp-banana-generate-variations-modal__list",style:{width:"200px",maxHeight:"420px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"8px"},children:ne.map(e=>{const a=e.id===ve?.id,n=e.data&&e.mime?`data:${e.mime};base64,${e.data}`:"";return(0,l.jsxs)("button",{type:"button",onClick:()=>ie(e.id),className:"button button-link",style:{display:"flex",flexDirection:"column",alignItems:"stretch",gap:"6px",padding:"6px",border:a?"2px solid #007cba":"1px solid #dcdcde",borderRadius:"4px",background:a?"#f0f6fc":"#fff",textAlign:"left"},children:[(0,l.jsxs)("div",{style:{position:"relative",height:"64px",background:"#f6f7f7",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",borderRadius:"3px"},children:["complete"===e.status||"saved"===e.status||"error"===e.status?n?(0,l.jsx)("img",{src:n,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,l.jsx)("span",{children:(0,t.__)("Preview unavailable","wp-banana")}):(0,l.jsx)(i.Spinner,{}),"saved"===e.status&&(0,l.jsx)("span",{style:{position:"absolute",top:"4px",right:"4px",background:"#007cba",color:"#fff",padding:"2px 6px",borderRadius:"3px",fontSize:"11px",fontWeight:600},children:(0,t.__)("Saved","wp-banana")})]}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[(0,l.jsx)("strong",{children:(0,t.sprintf)((0,t.__)("Variation %d","wp-banana"),e.index+1)}),(0,l.jsx)("span",{style:{fontSize:"12px",color:"#555"},children:m(e.status)})]})]},e.id)})}),(0,l.jsxs)("div",{className:"wp-banana-generate-variations-modal__preview",style:{flex:1,minWidth:"260px",display:"flex",flexDirection:"column",gap:"16px"},children:[(0,l.jsx)("div",{style:{position:"relative",background:"#f6f7f7",border:"1px solid #dcdcde",borderRadius:"4px",minHeight:"300px",display:"flex",alignItems:"center",justifyContent:"center",padding:"12px"},children:ve?"loading"===ve.status||"queued"===ve.status?(0,l.jsx)(i.Spinner,{}):"error"===ve.status?(0,l.jsx)(i.Notice,{status:"error",isDismissible:!1,children:null!==(v=ve.error)&&void 0!==v?v:(0,t.__)("Failed to generate image.","wp-banana")}):(0,l.jsxs)(l.Fragment,{children:[xe?(0,l.jsx)("img",{src:xe,alt:"",style:{maxWidth:"100%",maxHeight:"360px",borderRadius:"4px",objectFit:"contain"}}):(0,l.jsx)("span",{children:(0,t.__)("Preview unavailable","wp-banana")}),"saving"===ve.status&&(0,l.jsxs)("div",{style:{position:"absolute",inset:0,background:"rgba(255,255,255,0.7)",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,l.jsx)(i.Spinner,{})," ",(0,t.__)("Saving…","wp-banana")]})]}):(0,l.jsx)("span",{children:(0,t.__)("No preview selected.","wp-banana")})}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,l.jsx)(i.Button,{isPrimary:!0,onClick:ve?()=>Te(ve.id):void 0,disabled:!ye||"saving"===ve?.status,children:(0,t.__)("Save","wp-banana")}),(0,l.jsx)(i.Button,{variant:"secondary",onClick:ve?()=>Be(ve.id):void 0,disabled:!_e||"saving"===ve?.status,children:(0,t.__)("Discard","wp-banana")})]})]})]})]})]})};let g=null;const h=e=>{e.innerHTML="";const a=document.createElement("div");a.className="notice notice-warning";const n=document.createElement("p");n.textContent=(0,t.__)("No connected providers available. Add a key in Settings → AI Images.","wp-banana"),a.appendChild(n),e.appendChild(a)},w=()=>{const e=document.getElementById("wp-banana-generate-page");if(!e)return;const t=window.wpBananaGeneratePage;if(!t||!Array.isArray(t.providers))return void h(e);const n=t.providers.filter(e=>!1!==e.connected);0!==n.length?((e,t)=>{const n=window.wp?.element,r=()=>{t.redirectUrl?window.location.href=t.redirectUrl:window.location.reload()};if("function"==typeof n?.createRoot)return g||(g=n.createRoot(e)),void g.render((0,l.jsx)(f,{providers:t.providers,restNamespace:t.restNamespace,onComplete:r,defaultGeneratorModel:t.defaultGeneratorModel,defaultGeneratorProvider:t.defaultGeneratorProvider,defaultAspectRatio:t.defaultAspectRatio,aspectRatioOptions:t.aspectRatioOptions,enableReferenceDragDrop:!0}));(0,a.render)((0,l.jsx)(f,{providers:t.providers,restNamespace:t.restNamespace,onComplete:r,defaultGeneratorModel:t.defaultGeneratorModel,defaultGeneratorProvider:t.defaultGeneratorProvider,defaultAspectRatio:t.defaultAspectRatio,aspectRatioOptions:t.aspectRatioOptions,enableReferenceDragDrop:!0}),e)})(e,{restNamespace:t.restNamespace,providers:n,redirectUrl:t.redirectUrl,defaultGeneratorModel:t.defaultGeneratorModel,defaultGeneratorProvider:t.defaultGeneratorProvider,defaultAspectRatio:t.defaultAspectRatio,aspectRatioOptions:t.aspectRatioOptions}):h(e)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",w):w()})();